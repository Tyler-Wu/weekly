@model IEnumerable<WeeklyReport.Models.Project>

@{
    ViewBag.Title = "Index";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<div id="content" class="span10">
    <!-- content starts -->

    <div>
        <ul class="breadcrumb">
            <li>
                <a href="#">Home</a> <span class="divider">/</span>
            </li>
            <li>
                <a href="#">Tables</a>
            </li>
        </ul>
    </div>
    <div class="row-fluid sortable">
        <div class="box span12">
            <div class="box-header well" data-original-title>
                <h2><i class="icon-user"></i> Members</h2>
                <div class="box-icon">
                    <a href="#" class="btn btn-setting btn-round"><i class="icon-cog"></i></a>
                    <a href="#" class="btn btn-minimize btn-round"><i class="icon-chevron-up"></i></a>
                    <a href="#" class="btn btn-close btn-round"><i class="icon-remove"></i></a>
                </div>
            </div>
            <div>
                <div class="demo-content">
                    <div class="row">
                        <div class="span24">
                            <div id="grid">

                            </div>
                        </div>
                    </div>

                    <div id="content" class="hide">
                        <form class="form-horizontal" method="post">
                            <div class="row">
                                <div class="control-group span8">
                                    <label class="control-label"><s>*</s>文本：</label>
                                    <div class="controls">
                                        <input name="a" type="text" data-rules="{required:true}" class="input-normal control-text">
                                    </div>
                                </div>
                                <div class="control-group span8">
                                    <label class="control-label"><s>*</s>数字：</label>
                                    <div class="controls">
                                        <input name="b" type="text" data-rules="{required:true,number : true}" class="input-normal control-text">
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="control-group span8 ">
                                    <label class="control-label">日期：</label>
                                    <div id="range" class="controls">
                                        <input name="c" class="calendar" type="text">
                                    </div>
                                </div>
                                <div class="control-group span8">
                                    <label class="control-label">选择：</label>
                                    <div class="controls">
                                        <div class="controls bui-form-field-select" data-items="{'1':'选项一','2' : '选项二','3' : '选项三'}">
                                            <input name="d" type="hidden">
                                        </div>
                                    </div>
                                </div>

                            </div>
                            <div class="row">
                                <div class="control-group span15">
                                    <label class="control-label">备注：</label>
                                    <div class="controls control-row4">
                                        <textarea name="e" class="input-large" type="text"></textarea>
                                    </div>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
                <script src="~/Scripts/jquery-1.8.2.js"></script>
                 <script src="~/Scripts/BUI/bui.js"></script>
            <script type="text/javascript">
                var Grid = BUI.Grid,
                Data = BUI.Data;
                var Grid = Grid,
              Store = Data.Store,
              enumObj = { "1": "选项一", "2": "选项二", "3": "选项三" },
              columns = [
                { title: 'Name', dataIndex: 'Name', width: 150 }, //editor中的定义等用于 BUI.Form.Field.Text的定义
                { title: 'Leader', dataIndex: 'UName', width:150 },
                {
                    title: 'StartData', dataIndex: 'StartDate', width: 150, renderer: function (d) {
                        return new Date(parseInt(d.substr(6, 13))).toLocaleString().replace(/年|月/g, "-").replace(/日/g, " ");
                    }
                },
                { title: 'Description', dataIndex: 'Description', width:150 },
                { title: 'Status', dataIndex: 'Status', width: 150},
                { title: 'Color', dataIndex: 'Color', width:150 },
                {
                    title: '',
                    width:'500',
                    renderer: function () {
                        // return '<span class="grid-command btn-edit btn btn-info"><i class="icon-edit icon-white"> Edit</i></span>'
                        return '<span class="grid-command btn1 btn btn-success"><i class="icon-zoom-in icon-white"></i>View</span>' +
                            '<span class="grid-command btn2 btn btn-info"><i class="icon-edit icon-white"></i>Edit</span>' +
                        '<span class="grid-command btn3 btn btn-danger"><i class="icon-trash icon-white"></i>Delete</span>'
                    }
                }
              ];

                var editing = new Grid.Plugins.DialogEditing({
                    contentId: 'content', //设置隐藏的Dialog内容
                    triggerCls: 'btn-edit', //触发显示Dialog的样式
                    editor: {
                        success: function () {
                            var edtor = this,
                              form = edtor.get('form'),
                              editType = editing.get('editType'),//add 或者 edit
                              url = '/Project/GetProject';
                            /*if(editType == 'add'){ //可以根据编辑类型决定url
                              url = 'xxx';
                            }else{
                              url = 'xxxxx';
                            }*/
                           // url += '?saveType=' + editType;

                            //检验
                            form.valid();
                            if (form.isValid()) {
                                form.ajaxSubmit({ //表单异步提交
                                    url: url,
                                    success: function (data) {
                                        if (editType == 'add') {
                                            //do something
                                        } else {
                                            //do other
                                        }
                                        //将a 改成 1 测试一下显示错误
                                        if (data.hasError) { //返回的数据是 {hasError : fasle,error : 'xxxx',field : 'xxx'},也可以是任意格式的数据如 ： {success : false,'error' : 'xxxxx'}
                                            var field = data.field;
                                            form.getField(field).showErrors([data.error]); //也可以多个字段的错误信息 例如 errors : [{field : 'a',error: 'addd'},{field : 'a',error: 'addd'}]
                                        } else {
                                            edtor.accept();
                                        }

                                    },
                                    error: function () {
                                        //do something
                                    }
                                });
                            }
                        }
                    }
                }),
                  store = new Store({
                      url: '/Project/GetProject',
                      autoLoad: true,
                      pageSize: 2
                  }),
                  grid = new Grid.Grid({
                      render: '#grid',
                      columns: columns,
                      width:'100%',
                      forceFit: true,
                      bbar:{
                          // pagingBar:表明包含分页栏
                          pagingBar:true
                      },
                      //tbar: { //添加、删除
                      //    items: [{
                      //        btnCls: 'button button-small',
                      //        text: '<i class="icon-plus"></i>添加',
                      //        listeners: {
                      //            'click': addFunction
                      //        }
                      //    },
                      //    {
                      //        btnCls: 'button button-small',
                      //        text: '<i class="icon-remove"></i>删除',
                      //        listeners: {
                      //            'click': delFunction
                      //        }
                      //    }]
                      //},
                      //plugins: [editing, Grid.Plugins.CheckSelection],
                      store: store
                  });

                grid.render();

                //添加记录
                function addFunction() {
                    var newData = { b: 0 };

                    editing.add(newData, 'a', 0); //添加记录后，直接编辑
                }
                //删除选中的记录
                function delFunction() {
                    var selections = grid.getSelection();
                    //此处删除,项目中需要自己实现ajax 请求
                    store.remove(selections);
                }
            </script>
            </div>
            </div>
        </div><!--/row-->
    </div>

